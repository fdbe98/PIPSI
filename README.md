Pasarela-PIPSI
==============
Aquí se encuentra el contenido correspondiente al prototipo PIPSI desarrollado para el TFG. Al estar basado en Node-RED se encuentran los archivos necesarios para su uso.
### Pre-requisitos 📋
* La instalación tiene lugar para cualquier distribución Linux únicamente.
* Para instalar el proyecto es necesario disponer de Node.js con una version superior a la 10.x
* Comprobar que esté instalado el sistema de gestión de paquetes npm.

### Pasos para su instalación 🔧
Instalar Node-RED mediante npm:
```
sudo npm install -g --unsafe-perm node-red
```
En la consola arrancar Node-RED:
```
node-red
```
Seguidamente dirigirse al directorio _.node-red_ y abrir el fichero _settings.js_:
```
nano ~/.node-red/settings.js
```
Una vez dentro, al final del fichero hay que habilitar la opción de _projects_:
```
projects: {
  //To enable the Projects feature, set this value to true
  enabled: true,
  workflow: {
    // Set the default projects workflow mode.
    mode: "manual"
 }
```
Resetear Node-RED y acceder mediante un navegador a la dirección: localhost:1880

En la ventana emergente pulsar "_Clone Repository_" e introducir unas credenciales de github (no se va a compruebar su veracidad)

Después, introducir un nombre del proyecto, por ejemplo: _PIPSI_, indicar la URL de este repositorio:
```
https://github.com/fdbe98/PIPSI.git
```
y pulsar _Clone project_.

Ahora queda pendiente instalar las dependencias restantes y corregir los problemas. Para ello hay que dirigirse a la ventana de la derecha, _Info_, y a la derecha del nombre del proyecto abrir su configuración. Es aquí donde se instalan las 4 dependencias solicitadas.
* Las 3 últimas no tendrán problema en instalarse por ser públicas
* Pero la primera, **myWebsocket**, es un conjunto de ficheros creados específicamente para el prototipo.

Para solventar esto, hay que descargar el fichero _myWebsocket_ del repositorio y copiarlo en la siguiente ubicación:
```
~/.node-red/node_modules
```
***Nota: Es posible que debido a estas modificaciones alguans conexiones entre nodos se desconecten, por lo que será necesario reconectarlos manualmente***

A continuación, se muestra el código del prototipo en formato JSON:
```
[{"id":"eba5874f.3a6e38","type":"tab","label":"Pruebas","disabled":false,"info":""},{"id":"d82e681b.db9d","type":"tab","label":"PIPSI","disabled":false,"info":""},{"id":"c6d78d7b.d36f88","type":"subflow","name":"Dashboard_Dev1","info":"","category":"","in":[{"x":160,"y":120,"wires":[{"id":"d03c4f49.a5ffa8"}]}],"out":[],"env":[],"color":"#DDAA99"},{"id":"3d4d9d1d.b4ee6a","type":"subflow","name":"Dashboard_Dev1","info":"","category":"","in":[{"x":200,"y":120,"wires":[{"id":"1da443af.293b7c"}]}],"out":[],"env":[],"color":"#DDAA99"},{"id":"ce6c19fc.98d908","type":"subflow","name":"Configuracion_Dev1","info":"","category":"","in":[{"x":120,"y":80,"wires":[{"id":"60eec5df.2b65b4"},{"id":"14ef7fff.50219"}]}],"out":[{"x":640,"y":80,"wires":[{"id":"db0d11cf.67e218","port":0}]},{"x":440,"y":200,"wires":[{"id":"8a54976d.f45b8","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"f8f4e452.21dac","type":"subflow","name":"Configuracion_Dev2","info":"","category":"","in":[{"x":180,"y":80,"wires":[{"id":"1d808308.627465"},{"id":"c3c6e994.9b4418"}]}],"out":[{"x":620,"y":80,"wires":[{"id":"31656968.88bdfe","port":0}]},{"x":400,"y":180,"wires":[{"id":"4112dd6b.3196b4","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"4f00e6b5.36f52","type":"subflow","name":"MAPA","info":"","category":"","in":[{"x":120,"y":460,"wires":[{"id":"8aa3eb63.93e3f"}]}],"out":[],"env":[],"color":"#DDAA99"},{"id":"fd2745bb.814e48","type":"ui_group","name":"Grupo3","tab":"3a139d8.53a4362","order":1,"disp":true,"width":"27","collapse":false},{"id":"3a139d8.53a4362","type":"ui_tab","name":"Home","icon":"dashboard","order":2,"disabled":false,"hidden":false},{"id":"a312bb8e.67b4","type":"ui_tab","name":"Buscar","icon":"dashboard","order":3,"disabled":false,"hidden":false},{"id":"9943016a.2d823","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"4172af7e.4d8be8","type":"ui_group","name":"Grupo1","tab":"a312bb8e.67b4","order":1,"disp":true,"width":"6","collapse":false},{"id":"22787703.a0e968","type":"ui_group","name":"Web push notifications","tab":"","order":1,"disp":true,"width":"6","collapse":false},{"id":"2908388b.8114b8","type":"ui_group","name":"Floorplan test 2","tab":"a28ff08f.3a822","order":1,"disp":true,"width":"14","collapse":false},{"id":"a28ff08f.3a822","type":"ui_tab","name":"SVG","icon":"dashboard","order":5,"disabled":false,"hidden":false},{"id":"45e654b3.6f69fc","type":"fred-client","endpoint":"MostrarFile","private":false,"username":"borjaesteban98","wholemsg":"true"},{"id":"e583c334.a63eb8","type":"fred-client","endpoint":"ConectarWS","private":false,"username":"borjaesteban98","wholemsg":"false"},{"id":"ca6d7a12.4824c","type":"fred-client","endpoint":"MostrarFileRes","private":false,"username":"borjaesteban98","wholemsg":"true"},{"id":"948b2f03.477ee","type":"ui_group","name":"Network","tab":"","order":1,"disp":false,"width":17,"collapse":false},{"id":"feaef2f1.c0818","type":"ui_group","name":"Noisens","tab":"ac3fd3a7.1228","order":2,"disp":true,"width":"18","collapse":true},{"id":"ac3fd3a7.1228","type":"ui_tab","name":"Home","icon":"dashboard","order":1},{"id":"9ca1403e.76505","type":"ui_group","name":"Group 3","tab":"","order":1,"disp":true,"width":"6","collapse":false},{"id":"ddababd0.31ae6","type":"ui_group","name":"delete","tab":"3a139d8.53a4362","order":2,"disp":true,"width":"6","collapse":false},{"id":"e40e97d4.1356e8","type":"ui_group","name":"Menu","tab":"","order":1,"disp":true,"width":"6","collapse":false},{"id":"f2aefa84.a9a108","type":"ui_group","name":"Group 22","tab":"","order":3,"disp":true,"width":"6","collapse":false},{"id":"b09937f3.b814f8","type":"ui_group","name":"Group 1","tab":"","order":2,"disp":true,"width":"6","collapse":false},{"id":"75944167.0434b","type":"ui_group","name":"Group 3","tab":"","order":4,"disp":true,"width":"6","collapse":false},{"id":"25e5cf9b.11ff88","type":"ui_group","name":"Mapa","tab":"ac3fd3a7.1228","order":1,"disp":true,"width":"13","collapse":false},{"id":"68a0e91c.3567a8","type":"ui_group","name":"Noisens 2","tab":"ac3fd3a7.1228","order":3,"disp":true,"width":18,"collapse":false},{"id":"ff95faf3.24139","type":"ui_spacer","name":"spacer","group":"feaef2f1.c0818","order":1,"width":6,"height":1},{"id":"478455f4.8dfa2c","type":"ui_spacer","name":"spacer","group":"feaef2f1.c0818","order":3,"width":7,"height":1},{"id":"5341b176.d38fc","type":"ui_spacer","name":"spacer","group":"feaef2f1.c0818","order":8,"width":1,"height":1},{"id":"123d664b.1a1e4a","type":"ui_spacer","name":"spacer","group":"feaef2f1.c0818","order":9,"width":1,"height":1},{"id":"85be74e7.aaad","type":"ui_spacer","name":"spacer","group":"feaef2f1.c0818","order":10,"width":1,"height":1},{"id":"49c6f013.86ab68","type":"ui_spacer","name":"spacer","group":"feaef2f1.c0818","order":11,"width":1,"height":1},{"id":"417c33d5.af4374","type":"ui_spacer","name":"spacer","group":"feaef2f1.c0818","order":12,"width":1,"height":1},{"id":"efd0bdbe.a22d18","type":"ui_spacer","name":"spacer","group":"feaef2f1.c0818","order":13,"width":1,"height":1},{"id":"c68f07e4.5c4fa","type":"ui_spacer","name":"spacer","group":"feaef2f1.c0818","order":14,"width":1,"height":1},{"id":"372e97b7.9d1c18","type":"ui_spacer","name":"spacer","group":"feaef2f1.c0818","order":15,"width":1,"height":1},{"id":"fda3463e.23e358","type":"ui_spacer","name":"spacer","group":"68a0e91c.3567a8","order":1,"width":6,"height":1},{"id":"f05bfb92.2c3ad","type":"ui_spacer","name":"spacer","group":"68a0e91c.3567a8","order":3,"width":7,"height":1},{"id":"d20ea1a1.02fe3","type":"ui_spacer","name":"spacer","group":"68a0e91c.3567a8","order":8,"width":1,"height":1},{"id":"af7cff5e.609f3","type":"ui_spacer","name":"spacer","group":"68a0e91c.3567a8","order":9,"width":1,"height":1},{"id":"e7b97cf1.c1e29","type":"ui_spacer","name":"spacer","group":"68a0e91c.3567a8","order":10,"width":1,"height":1},{"id":"69cf8ecf.de56b8","type":"ui_spacer","name":"spacer","group":"68a0e91c.3567a8","order":11,"width":1,"height":1},{"id":"f91df8d9.aa4c7","type":"ui_spacer","name":"spacer","group":"68a0e91c.3567a8","order":12,"width":1,"height":1},{"id":"15335c71.cf5d04","type":"ui_spacer","name":"spacer","group":"68a0e91c.3567a8","order":13,"width":1,"height":1},{"id":"6379db37.942074","type":"ui_spacer","name":"spacer","group":"68a0e91c.3567a8","order":14,"width":1,"height":1},{"id":"449ecac.df566b4","type":"ui_spacer","name":"spacer","group":"68a0e91c.3567a8","order":15,"width":1,"height":1},{"id":"9945dbba.16d668","type":"http in","z":"eba5874f.3a6e38","name":"","url":"/dev1","method":"get","upload":false,"swaggerDoc":"","x":140,"y":800,"wires":[["3bd1a559.3f5b02"]]},{"id":"130cc558.3d509b","type":"http response","z":"eba5874f.3a6e38","name":"","statusCode":"","headers":{},"x":1030,"y":880,"wires":[]},{"id":"16c73f12.b55f51","type":"http request","z":"eba5874f.3a6e38","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"http://www.localhost:8081/dev1","tls":"","persist":false,"proxy":"","authType":"","x":410,"y":640,"wires":[["75a656ef.ba2a2"]]},{"id":"78f3ed8d.b566f4","type":"inject","z":"eba5874f.3a6e38","name":"make request","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":210,"y":640,"wires":[["16c73f12.b55f51"]]},{"id":"4f1ea469.99dcbc","type":"debug","z":"eba5874f.3a6e38","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1190,"y":640,"wires":[]},{"id":"73867d9c.8e9df4","type":"change","z":"eba5874f.3a6e38","name":"","rules":[{"t":"set","p":"filename","pt":"msg","to":"/home/borja/Desktop/1000C1000E1B/history/10h/1000C1000E1B-20200304-12:39:18.cnd","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":450,"y":80,"wires":[["bfbe3682.d629a8"]]},{"id":"dbe9e4c.d0a9518","type":"inject","z":"eba5874f.3a6e38","name":"","props":[{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":170,"y":80,"wires":[["73867d9c.8e9df4"]]},{"id":"8d646d17.3e93f","type":"debug","z":"eba5874f.3a6e38","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1210,"y":80,"wires":[]},{"id":"bfbe3682.d629a8","type":"file in","z":"eba5874f.3a6e38","name":"","filename":"","format":"","chunk":false,"sendError":false,"encoding":"binary","x":650,"y":80,"wires":[["8cadf76b.bbf8f"]]},{"id":"649e3dee.c21694","type":"inject","z":"eba5874f.3a6e38","name":"","props":[{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":170,"y":200,"wires":[["2f03e28e.8f151e"]]},{"id":"d42e70c.8f4d69","type":"debug","z":"eba5874f.3a6e38","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1170,"y":200,"wires":[]},{"id":"2f03e28e.8f151e","type":"file in","z":"eba5874f.3a6e38","name":"","filename":"/home/borja/Desktop/1000C1000E1B/history/10h/1000C1000E1B-20200304-12:39:18.cnd","format":"","chunk":false,"sendError":false,"encoding":"none","x":550,"y":240,"wires":[["19164410.633144"]]},{"id":"c7ee48e7.0c9568","type":"function","z":"eba5874f.3a6e38","name":"SACAR ULTIMO DATO","func":"//Buscar fichero mas reciente y devolver su ultimo dato registrado\nvar len = msg.payload.length;\nlet array=[];\n\n//var json1 = JSON.parse(array);\n\nvar ts= msg.payload[len-13].toString(16);\nts += msg.payload[len-14].toString(16);\nts += msg.payload[len-15].toString(16);\nts += msg.payload[len-16].toString(16);\narray.push(parseInt(ts,16));\n\nvar var1 = msg.payload[len-11].toString(16);\nvar1 += msg.payload[len-12].toString(16);\narray.push(parseFloat(parseInt(var1,16))/10);\n\nvar var2 = msg.payload[len-9].toString(16);\nvar2 += msg.payload[len-10].toString(16);\narray.push(parseFloat(parseInt(var2,16))/10);\n\nvar var3 = msg.payload[len-7].toString(16);\nvar3 += msg.payload[len-8].toString(16);\narray.push(parseFloat(parseInt(var3,16))/10);\n\nvar var4 = msg.payload[len-5].toString(16);\nvar4 += msg.payload[len-6].toString(16);\narray.push(parseFloat(parseInt(var4,16))/10);\n\nvar var5 = msg.payload[len-3].toString(16);\nvar5 += msg.payload[len-4].toString(16);\narray.push(parseFloat(parseInt(var5,16))/10);\n\nvar var6 = msg.payload[len-1].toString(16);\nvar6+= msg.payload[len-2].toString(16);\narray.push(parseFloat(parseInt(var6,16))/10);\n\nvar json1 = JSON.stringify(array);\nmsg.payload = json1;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":850,"y":140,"wires":[["8ed1da55.b1f498"]]},{"id":"9016dfbd.87ec8","type":"inject","z":"eba5874f.3a6e38","name":"","props":[{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":170,"y":140,"wires":[["196b4d02.8dafa3"]]},{"id":"a9fcc7fc.5efa28","type":"debug","z":"eba5874f.3a6e38","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1210,"y":140,"wires":[]},{"id":"a399c135.43f19","type":"file in","z":"eba5874f.3a6e38","name":"","filename":"","format":"","chunk":false,"sendError":false,"encoding":"binary","x":650,"y":140,"wires":[["c7ee48e7.0c9568","8d646d17.3e93f"]]},{"id":"196b4d02.8dafa3","type":"function","z":"eba5874f.3a6e38","name":"","func":"msg.filename = \"/home/borja/Desktop/1000C1000E1B/history/10h/1000C1000E1B-20200304-12:39:18.cnd\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":440,"y":140,"wires":[["a399c135.43f19"]]},{"id":"cd74a42e.06f018","type":"debug","z":"eba5874f.3a6e38","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1050,"y":800,"wires":[]},{"id":"e4b37107.c38fa","type":"comment","z":"eba5874f.3a6e38","name":"HTTP","info":"","x":150,"y":560,"wires":[]},{"id":"f8207e1c.d3d7a","type":"comment","z":"eba5874f.3a6e38","name":"DASHBOARD","info":"","x":130,"y":1320,"wires":[]},{"id":"38cc8b21.5bd5a4","type":"comment","z":"eba5874f.3a6e38","name":"DATOS FICHEROS","info":"","x":130,"y":40,"wires":[]},{"id":"8ed1da55.b1f498","type":"json","z":"eba5874f.3a6e38","name":"","property":"payload","action":"","pretty":false,"x":1050,"y":140,"wires":[["a9fcc7fc.5efa28"]]},{"id":"a5ba326a.20e07","type":"inject","z":"eba5874f.3a6e38","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":340,"wires":[["d5138f2a.d8fcc"]]},{"id":"e5fe9574.3cae28","type":"debug","z":"eba5874f.3a6e38","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1090,"y":340,"wires":[]},{"id":"d5138f2a.d8fcc","type":"file in","z":"eba5874f.3a6e38","name":"","filename":"/home/borja/Desktop/1000C1000E1B/history/10h/1000C1000E1B-20200107-08:18:20.cnd","format":"","chunk":false,"sendError":false,"encoding":"binary","x":550,"y":320,"wires":[["80c186ec.52ac58"]]},{"id":"43c82ae7.0689c4","type":"file","z":"eba5874f.3a6e38","name":"","filename":"/home/borja/Desktop/1000C1000E1B-20200304-12:39:18.txt","appendNewline":true,"createDir":true,"overwriteFile":"true","encoding":"none","x":920,"y":500,"wires":[[]]},{"id":"aab9541b.66bcf8","type":"json","z":"eba5874f.3a6e38","name":"","property":"payload","action":"","pretty":false,"x":910,"y":440,"wires":[["43c82ae7.0689c4"]]},{"id":"1f87eafd.593ef5","type":"inject","z":"eba5874f.3a6e38","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":1440,"wires":[["d58bc8da.fab078"]]},{"id":"d58bc8da.fab078","type":"file in","z":"eba5874f.3a6e38","name":"","filename":"/home/borja/Desktop/1000C1000E1B/history/5m/1000C1000E1B-20200109-19:00:00.cnd","format":"","chunk":false,"sendError":false,"encoding":"binary","x":450,"y":1520,"wires":[["558e0235.2fe574","19904bfe.8680f4"]]},{"id":"19904bfe.8680f4","type":"function","z":"eba5874f.3a6e38","name":"MOSTRAR TODO FICHERO RT","func":"var len = msg.payload.length;\nvar num = len/16;\nconst tam = 16;\nlet array=[];\nvar dato = [];\n//var json1 = JSON.stringify(array);\n//var json1 = JSON.parse(array);\n\nfor(i = 0; i < len; i+=16){\n\nvar ts= msg.payload[3+i].toString(16);\nts += msg.payload[2+i].toString(16);\nts += msg.payload[1+i].toString(16);\nts += msg.payload[0+i].toString(16);\narray.push(parseInt(ts,16)*1000);\n\nvar var1 = msg.payload[5+i].toString(16);\nvar1 += msg.payload[4+i].toString(16);\narray.push(parseFloat(parseInt(var1,16))/10);\n\nvar var2 = msg.payload[7+i].toString(16);\nvar2 += msg.payload[6+i].toString(16);\narray.push(parseFloat(parseInt(var2,16))/10);\n\nvar var3 = msg.payload[9+i].toString(16);\nvar3 += msg.payload[8+i].toString(16);\narray.push(parseFloat(parseInt(var3,16))/10);\n\nvar var4 = msg.payload[11+i].toString(16);\nvar4 += msg.payload[10+i].toString(16);\narray.push(parseFloat(parseInt(var4,16))/10);\n\nvar var5 = msg.payload[13+i].toString(16);\nvar5 += msg.payload[12+i].toString(16);\narray.push(parseFloat(parseInt(var5,16))/10);\n\nvar var6 = msg.payload[15+i].toString(16);\nvar6+= msg.payload[14+i].toString(16);\narray.push(parseFloat(parseInt(var6,16))/10);\n\nvar data1={\"timestamp\":array[0],\"var1\":array[1],\"var2\":array[2],\"var3\":array[3],\"var4\":array[4],\"var5\":array[5],\"var6\":array[6]};\ndato = [].concat(dato,data1);\narray = [];\ndata1={};\n\n}\nmsg.payload = dato;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":610,"y":1600,"wires":[["f1d5036e.e8744"]]},{"id":"a27b317c.5fff3","type":"ui_chart","z":"eba5874f.3a6e38","name":"","group":"fd2745bb.814e48","order":3,"width":"27","height":"10","label":"chart_decibelios","chartType":"line","legend":"false","xformat":"auto","interpolate":"linear","nodata":"","dot":true,"ymin":"","ymax":"","removeOlder":"1","removeOlderPoints":"300","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"x":1240,"y":1520,"wires":[[]]},{"id":"615c094b.2a7488","type":"change","z":"eba5874f.3a6e38","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"decibelios","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"payload.var1","tot":"msg"},{"t":"set","p":"timestamp","pt":"msg","to":"payload.timestamp","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":1640,"wires":[[]]},{"id":"e297c1a.8f3134","type":"ui_button","z":"eba5874f.3a6e38","name":"","group":"fd2745bb.814e48","order":4,"width":"6","height":"2","passthru":false,"label":"Muestra gráfica","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":120,"y":1600,"wires":[["d58bc8da.fab078"]]},{"id":"b695f9ce.b094e8","type":"change","z":"eba5874f.3a6e38","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"[]","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":720,"y":1780,"wires":[["a27b317c.5fff3","ee5bdad.2232a28","bdccf486.b7c598"]]},{"id":"fe399eeb.5c4e8","type":"ui_button","z":"eba5874f.3a6e38","name":"","group":"fd2745bb.814e48","order":2,"width":0,"height":0,"passthru":false,"label":"Limpiar","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":400,"y":1780,"wires":[["b695f9ce.b094e8"]]},{"id":"9a196785.951738","type":"ui_date_picker","z":"eba5874f.3a6e38","name":"","label":"date ini","group":"fd2745bb.814e48","order":4,"width":0,"height":0,"passthru":true,"topic":"","x":220,"y":1920,"wires":[["bdccf486.b7c598","1c2b2fe6.570c4"]]},{"id":"bdccf486.b7c598","type":"ui_text","z":"eba5874f.3a6e38","group":"fd2745bb.814e48","order":6,"width":0,"height":0,"name":"","label":"text","format":"{{msg.payload}}","layout":"row-spread","x":450,"y":1920,"wires":[]},{"id":"aa575a5a.abd268","type":"ui_date_picker","z":"eba5874f.3a6e38","name":"","label":"date fin","group":"fd2745bb.814e48","order":4,"width":0,"height":0,"passthru":true,"topic":"","x":220,"y":2000,"wires":[["ee5bdad.2232a28","1c2b2fe6.570c4"]]},{"id":"ee5bdad.2232a28","type":"ui_text","z":"eba5874f.3a6e38","group":"fd2745bb.814e48","order":6,"width":0,"height":0,"name":"","label":"text","format":"{{msg.payload}}","layout":"row-spread","x":450,"y":2000,"wires":[]},{"id":"950c97d8.399548","type":"function","z":"eba5874f.3a6e38","name":"","func":"//if (msg.payload == true)\n//var array = [msg.payload,msg.payload];\n\n\n//msg.payload = array;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":2200,"wires":[["25ca045b.da204c"]]},{"id":"25ca045b.da204c","type":"debug","z":"eba5874f.3a6e38","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":720,"y":2220,"wires":[]},{"id":"47d5d02d.11a5e","type":"comment","z":"eba5874f.3a6e38","name":"Escoger rango de fechas para mostrar datos. Si no se tocan se supone los datos de hoy (switch). Incluir ambos botones+ tercero para \"Buscar\"","info":"Escoger rango de fechas para mostrar datos\nSi no se tocan se supone los datos de hoy (switch)","x":530,"y":1860,"wires":[]},{"id":"4d2ce085.b029b","type":"ui_button","z":"eba5874f.3a6e38","name":"","group":"fd2745bb.814e48","order":9,"width":0,"height":0,"passthru":true,"label":"Buscar","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":340,"y":2200,"wires":[[]]},{"id":"25efeef.f3b5a12","type":"debug","z":"eba5874f.3a6e38","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"dataIn","targetType":"msg","statusVal":"","statusType":"auto","x":830,"y":1940,"wires":[]},{"id":"f9e7a57a.66c7f8","type":"debug","z":"eba5874f.3a6e38","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"dataOut","targetType":"msg","statusVal":"","statusType":"auto","x":790,"y":2080,"wires":[]},{"id":"1c2b2fe6.570c4","type":"join","z":"eba5874f.3a6e38","name":"","mode":"custom","build":"string","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"num","reduceFixup":"","x":510,"y":2100,"wires":[["950c97d8.399548","e5fe654f.bba968"]]},{"id":"e5fe654f.bba968","type":"debug","z":"eba5874f.3a6e38","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":840,"y":2160,"wires":[]},{"id":"f1d5036e.e8744","type":"function","z":"eba5874f.3a6e38","name":"FUNCION PARA RT","func":"var chartdata = msg.payload\n\nfor(var i = 1;i<chartdata.length ; i++){\n    msg = {payload:chartdata[i].var1, timestamp:chartdata[i].timestamp};\n    node.send(msg);\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":880,"y":1600,"wires":[[]]},{"id":"19164410.633144","type":"function","z":"eba5874f.3a6e38","name":"SACAR ULTIMO DATO","func":"//Buscar fichero mas reciente y devolver su ultimo dato registrado\nvar len = msg.payload.length;\nlet array=[];\n\n//var json1 = JSON.parse(array);\n\nvar ts= msg.payload[len-13].toString(16);\nts += msg.payload[len-14].toString(16);\nts += msg.payload[len-15].toString(16);\nts += msg.payload[len-16].toString(16);\narray.push(parseInt(ts,16));\n\nvar var1 = msg.payload[len-11].toString(16);\nvar1 += msg.payload[len-12].toString(16);\narray.push(parseFloat(parseInt(var1,16))/10);\n\nvar var2 = msg.payload[len-9].toString(16);\nvar2 += msg.payload[len-10].toString(16);\narray.push(parseFloat(parseInt(var2,16))/10);\n\nvar var3 = msg.payload[len-7].toString(16);\nvar3 += msg.payload[len-8].toString(16);\narray.push(parseFloat(parseInt(var3,16))/10);\n\nvar var4 = msg.payload[len-5].toString(16);\nvar4 += msg.payload[len-6].toString(16);\narray.push(parseFloat(parseInt(var4,16))/10);\n\nvar var5 = msg.payload[len-3].toString(16);\nvar5 += msg.payload[len-4].toString(16);\narray.push(parseFloat(parseInt(var5,16))/10);\n\nvar var6 = msg.payload[len-1].toString(16);\nvar6+= msg.payload[len-2].toString(16);\narray.push(parseFloat(parseInt(var6,16))/10);\n\n//var json1 = JSON.stringify(array);\n//msg.payload = json1;\nvar data={\"timestamp\":array[0],\"var1\":array[1],\"var2\":array[2],\"var3\":array[3],\"var4\":array[4],\"var5\":array[5],\"var6\":array[6]};\nmsg.payload = data;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":930,"y":200,"wires":[["d42e70c.8f4d69"]]},{"id":"8cadf76b.bbf8f","type":"function","z":"eba5874f.3a6e38","name":"SACAR ULTIMO DATO","func":"//Buscar fichero mas reciente y devolver su ultimo dato registrado\nvar len = msg.payload.length;\nlet array=[];\n\n//var json1 = JSON.parse(array);\n\nvar ts= msg.payload[len-13].toString(16);\nts += msg.payload[len-14].toString(16);\nts += msg.payload[len-15].toString(16);\nts += msg.payload[len-16].toString(16);\narray.push(parseInt(ts,16));\n\nvar var1 = msg.payload[len-11].toString(16);\nvar1 += msg.payload[len-12].toString(16);\narray.push(parseFloat(parseInt(var1,16))/10);\n\nvar var2 = msg.payload[len-9].toString(16);\nvar2 += msg.payload[len-10].toString(16);\narray.push(parseFloat(parseInt(var2,16))/10);\n\nvar var3 = msg.payload[len-7].toString(16);\nvar3 += msg.payload[len-8].toString(16);\narray.push(parseFloat(parseInt(var3,16))/10);\n\nvar var4 = msg.payload[len-5].toString(16);\nvar4 += msg.payload[len-6].toString(16);\narray.push(parseFloat(parseInt(var4,16))/10);\n\nvar var5 = msg.payload[len-3].toString(16);\nvar5 += msg.payload[len-4].toString(16);\narray.push(parseFloat(parseInt(var5,16))/10);\n\nvar var6 = msg.payload[len-1].toString(16);\nvar6+= msg.payload[len-2].toString(16);\narray.push(parseFloat(parseInt(var6,16))/10);\n\nvar json1 = JSON.stringify(array);\nmsg.payload = json1;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":930,"y":80,"wires":[[]]},{"id":"80c186ec.52ac58","type":"function","z":"eba5874f.3a6e38","name":"MOSTRAR TODO FICHERO","func":"var len = msg.payload.length;\nvar num = len/16;\nconst tam = 16;\nlet array=[];\nvar dato = [];\n//var json1 = JSON.stringify(array);\n//var json1 = JSON.parse(array);\n\nfor(i = 0; i < len; i+=16){\n\nvar ts= msg.payload[3+i].toString(16);\nts += msg.payload[2+i].toString(16);\nts += msg.payload[1+i].toString(16);\nts += msg.payload[0+i].toString(16);\narray.push(parseInt(ts,16)*1000);\n\nvar var1 = msg.payload[5+i].toString(16);\nvar1 += msg.payload[4+i].toString(16);\narray.push(parseFloat(parseInt(var1,16))/10);\n\nvar var2 = msg.payload[7+i].toString(16);\nvar2 += msg.payload[6+i].toString(16);\narray.push(parseFloat(parseInt(var2,16))/10);\n\nvar var3 = msg.payload[9+i].toString(16);\nvar3 += msg.payload[8+i].toString(16);\narray.push(parseFloat(parseInt(var3,16))/10);\n\nvar var4 = msg.payload[11+i].toString(16);\nvar4 += msg.payload[10+i].toString(16);\narray.push(parseFloat(parseInt(var4,16))/10);\n\nvar var5 = msg.payload[13+i].toString(16);\nvar5 += msg.payload[12+i].toString(16);\narray.push(parseFloat(parseInt(var5,16))/10);\n\nvar var6 = msg.payload[15+i].toString(16);\nvar6+= msg.payload[14+i].toString(16);\narray.push(parseFloat(parseInt(var6,16))/10);\n\nvar data1={\"timestamp\":array[0],\"var1\":array[1],\"var2\":array[2],\"var3\":array[3],\"var4\":array[4],\"var5\":array[5],\"var6\":array[6]};\ndato = [].concat(dato,data1);\narray = [];\ndata1={};\n\n}\nmsg.payload = dato;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":840,"y":380,"wires":[["aab9541b.66bcf8","e5fe9574.3cae28"]]},{"id":"6dcc2dcb.0c9d1c","type":"function","z":"eba5874f.3a6e38","name":"SACAR ULTIMO DATO","func":"//Buscar fichero mas reciente y devolver su ultimo dato registrado\nvar len = msg.payload.length;\nlet array=[];\n\n//var json1 = JSON.parse(array);\n\nvar ts= msg.payload[len-13].toString(16);\nts += msg.payload[len-14].toString(16);\nts += msg.payload[len-15].toString(16);\nts += msg.payload[len-16].toString(16);\narray.push(parseInt(ts,16));\n\nvar var1 = msg.payload[len-11].toString(16);\nvar1 += msg.payload[len-12].toString(16);\narray.push(parseFloat(parseInt(var1,16))/10);\n\nvar var2 = msg.payload[len-9].toString(16);\nvar2 += msg.payload[len-10].toString(16);\narray.push(parseFloat(parseInt(var2,16))/10);\n\nvar var3 = msg.payload[len-7].toString(16);\nvar3 += msg.payload[len-8].toString(16);\narray.push(parseFloat(parseInt(var3,16))/10);\n\nvar var4 = msg.payload[len-5].toString(16);\nvar4 += msg.payload[len-6].toString(16);\narray.push(parseFloat(parseInt(var4,16))/10);\n\nvar var5 = msg.payload[len-3].toString(16);\nvar5 += msg.payload[len-4].toString(16);\narray.push(parseFloat(parseInt(var5,16))/10);\n\nvar var6 = msg.payload[len-1].toString(16);\nvar6+= msg.payload[len-2].toString(16);\narray.push(parseFloat(parseInt(var6,16))/10);\n\nvar json1 = JSON.stringify(array);\nmsg.payload = json1;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":550,"y":800,"wires":[["cd74a42e.06f018","ae4cad1e.e22718"]]},{"id":"558e0235.2fe574","type":"function","z":"eba5874f.3a6e38","name":"MOSTRAR TODO FICHERO FIJO","func":"var len = msg.payload.length;\nvar num = len/16;\nconst tam = 16;\nlet array=[];\nvar dato = [];\n\nfor(i = 0; i < len; i+=16){\n\nvar ts= msg.payload[3+i].toString(16);\nts += msg.payload[2+i].toString(16);\nts += msg.payload[1+i].toString(16);\nts += msg.payload[0+i].toString(16);\narray.push(parseInt(ts,16)*1000);\n\nvar var1 = msg.payload[5+i].toString(16);\nvar1 += msg.payload[4+i].toString(16);\narray.push(parseFloat(parseInt(var1,16))/10);\nif (array[0]>1578592800000){\n    var data1={\"x\":array[0],\"y\":array[1]};\n    dato = [].concat(dato,data1);\n}\narray = [];\ndata1={};\n\n}\nmsg.payload = dato;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":620,"y":1420,"wires":[["541f5fe8.99401","ef3d4635.60177"]]},{"id":"541f5fe8.99401","type":"function","z":"eba5874f.3a6e38","name":"FUNCION VALORES FIJOS","func":"var chart = [{\n    \"series\":[\"Media\"],\n    \"data\":[msg.payload],\n    \"labels\":[\"\"]\n}];\nmsg.payload = chart;\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1020,"y":1420,"wires":[["a27b317c.5fff3","adbf1fa5.98c06"]]},{"id":"ed6bf64a.6467b8","type":"ui_button","z":"eba5874f.3a6e38","name":"","group":"4172af7e.4d8be8","order":9,"width":0,"height":0,"passthru":true,"label":"10H","tooltip":"","color":"","bgcolor":"","icon":"","payload":"10h/","payloadType":"str","topic":"","x":110,"y":2500,"wires":[["663c2385.77c85c"]]},{"id":"3b06abd0.57cb54","type":"change","z":"eba5874f.3a6e38","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"[]","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1020,"y":2500,"wires":[["f5e5ed4e.97235"]]},{"id":"aa5103e4.06c32","type":"ui_button","z":"eba5874f.3a6e38","name":"","group":"4172af7e.4d8be8","order":2,"width":0,"height":0,"passthru":false,"label":"Limpiar","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":960,"y":2420,"wires":[["3b06abd0.57cb54"]]},{"id":"6992363f.2ab708","type":"function","z":"eba5874f.3a6e38","name":"SACAR ULTIMO DATO","func":"//Buscar fichero mas reciente y devolver su ultimo dato registrado\nvar len = msg.payload.length;\nlet array=[];\n\n//var json1 = JSON.parse(array);\n\nvar ts= msg.payload[len-13].toString(16);\nts += msg.payload[len-14].toString(16);\nts += msg.payload[len-15].toString(16);\nts += msg.payload[len-16].toString(16);\narray.push(parseInt(ts,16)*1000);\n\nvar var1 = msg.payload[len-11].toString(16);\nvar1 += msg.payload[len-12].toString(16);\narray.push(parseFloat(parseInt(var1,16))/10);\n\nvar var2 = msg.payload[len-9].toString(16);\nvar2 += msg.payload[len-10].toString(16);\narray.push(parseFloat(parseInt(var2,16))/10);\n\nvar var3 = msg.payload[len-7].toString(16);\nvar3 += msg.payload[len-8].toString(16);\narray.push(parseFloat(parseInt(var3,16))/10);\n\nvar var4 = msg.payload[len-5].toString(16);\nvar4 += msg.payload[len-6].toString(16);\narray.push(parseFloat(parseInt(var4,16))/10);\n\nvar var5 = msg.payload[len-3].toString(16);\nvar5 += msg.payload[len-4].toString(16);\narray.push(parseFloat(parseInt(var5,16))/10);\n\nvar var6 = msg.payload[len-1].toString(16);\nvar6+= msg.payload[len-2].toString(16);\narray.push(parseFloat(parseInt(var6,16))/10);\n\nvar data={\"timestamp\":array[0],\"var1\":array[1],\"var2\":array[2],\"var3\":array[3],\"var4\":array[4],\"var5\":array[5],\"var6\":array[6]};\nmsg.payload = data;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1170,"y":2620,"wires":[["f5e5ed4e.97235"]]},{"id":"914f9e3d.3a09f8","type":"file in","z":"eba5874f.3a6e38","name":"","filename":"","format":"","chunk":false,"sendError":false,"encoding":"binary","x":970,"y":2620,"wires":[["6992363f.2ab708"]]},{"id":"f5e5ed4e.97235","type":"ui_gauge","z":"eba5874f.3a6e38","name":"","group":"4172af7e.4d8be8","order":4,"width":"6","height":"6","gtype":"gage","title":"gauge","label":"dB","format":"{{msg.payload.var1}}","min":"40","max":"110","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":1210,"y":2500,"wires":[]},{"id":"9cd5deb5.af269","type":"function","z":"eba5874f.3a6e38","name":"","func":"var file = msg.payload;\nmsg.filename = \"/home/borja/Desktop/1000C1000E1B/history/10h/\";\nmsg.filename = msg.filename+file;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":780,"y":2500,"wires":[["914f9e3d.3a09f8"]]},{"id":"663c2385.77c85c","type":"exec","z":"eba5874f.3a6e38","command":"ls  /home/borja/Desktop/1000C1000E1B/history/10h/ -t | head -n 1","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":440,"y":2500,"wires":[["9cd5deb5.af269"],[],[]]},{"id":"203fe1f1.acb686","type":"ui_button","z":"eba5874f.3a6e38","name":"","group":"4172af7e.4d8be8","order":9,"width":0,"height":0,"passthru":false,"label":"2H","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"num","topic":"","x":110,"y":2560,"wires":[["92e458ff.c05148"]]},{"id":"92e458ff.c05148","type":"exec","z":"eba5874f.3a6e38","command":"ls  /home/borja/Desktop/1000C1000E1B/history/2h/ -t | head -n1","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":430,"y":2560,"wires":[["6dfe97d0.a0e64"],[],[]]},{"id":"6355a116.d07378","type":"ui_button","z":"eba5874f.3a6e38","name":"","group":"4172af7e.4d8be8","order":9,"width":0,"height":0,"passthru":false,"label":"30M","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"num","topic":"","x":110,"y":2620,"wires":[["b685b79b.870c18"]]},{"id":"b685b79b.870c18","type":"exec","z":"eba5874f.3a6e38","command":"ls  /home/borja/Desktop/1000C1000E1B/history/30m/ -t | head -n1","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":440,"y":2620,"wires":[["ba1bf65b.f9dd58"],[],[]]},{"id":"e753d63a.e45f1","type":"ui_button","z":"eba5874f.3a6e38","name":"","group":"4172af7e.4d8be8","order":9,"width":0,"height":0,"passthru":false,"label":"5M","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"num","topic":"","x":110,"y":2680,"wires":[["637263f5.b663d4"]]},{"id":"637263f5.b663d4","type":"exec","z":"eba5874f.3a6e38","command":"ls  /home/borja/Desktop/1000C1000E1B/history/5m/ -t | head -n1","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":430,"y":2680,"wires":[["ee94766f.e41ff8"],[],[]]},{"id":"18d4f7f3.10df3","type":"ui_button","z":"eba5874f.3a6e38","name":"","group":"4172af7e.4d8be8","order":9,"width":0,"height":0,"passthru":false,"label":"60S","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"num","topic":"","x":110,"y":2740,"wires":[["b717f01b.8232b"]]},{"id":"b717f01b.8232b","type":"exec","z":"eba5874f.3a6e38","command":"ls  /home/borja/Desktop/1000C1000E1B/history/60s/ -t | head -n1","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":430,"y":2740,"wires":[["2f52fd19.014a22"],[],[]]},{"id":"6dfe97d0.a0e64","type":"function","z":"eba5874f.3a6e38","name":"","func":"var file = msg.payload;\nmsg.filename = \"/home/borja/Desktop/1000C1000E1B/history/2h/\";\nmsg.filename = msg.filename+file;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":780,"y":2560,"wires":[["914f9e3d.3a09f8"]]},{"id":"ba1bf65b.f9dd58","type":"function","z":"eba5874f.3a6e38","name":"","func":"var file = msg.payload;\nmsg.filename = \"/home/borja/Desktop/1000C1000E1B/history/30m/\";\nmsg.filename = msg.filename+file;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":780,"y":2620,"wires":[["914f9e3d.3a09f8"]]},{"id":"ee94766f.e41ff8","type":"function","z":"eba5874f.3a6e38","name":"","func":"var file = msg.payload;\nmsg.filename = \"/home/borja/Desktop/1000C1000E1B/history/5m/\";\nmsg.filename = msg.filename+file;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":780,"y":2680,"wires":[["914f9e3d.3a09f8"]]},{"id":"2f52fd19.014a22","type":"function","z":"eba5874f.3a6e38","name":"","func":"var file = msg.payload;\nmsg.filename = \"/home/borja/Desktop/1000C1000E1B/history/60s/\";\nmsg.filename = msg.filename+file;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":780,"y":2740,"wires":[["914f9e3d.3a09f8"]]},{"id":"9bf5fbc3.36e5b8","type":"split","z":"eba5874f.3a6e38","name":"","splt":"\\n","spltType":"str","arraySplt":"1","arraySpltType":"len","stream":false,"addname":"","x":730,"y":1640,"wires":[["615c094b.2a7488"]]},{"id":"ae4cad1e.e22718","type":"template","z":"eba5874f.3a6e38","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"This is the payload: {{payload}} !","output":"str","x":820,"y":840,"wires":[["130cc558.3d509b"]]},{"id":"3bd1a559.3f5b02","type":"file in","z":"eba5874f.3a6e38","name":"FICHERO","filename":"/home/borja/Desktop/1000C1000E1B/history/5m/1000C1000E1B-20200109-19:00:00.cnd","format":"","chunk":false,"sendError":false,"encoding":"binary","x":320,"y":800,"wires":[["6dcc2dcb.0c9d1c"]]},{"id":"85e25b47.25c418","type":"http in","z":"eba5874f.3a6e38","name":"","url":"/dev1/60s","method":"get","upload":false,"swaggerDoc":"","x":160,"y":900,"wires":[["92d543bb.6268c8"]]},{"id":"92d543bb.6268c8","type":"file in","z":"eba5874f.3a6e38","name":"FICHERO","filename":"/home/borja/Desktop/1000C1000E1B/history/5m/1000C1000E1B-20200109-19:00:00.cnd","format":"","chunk":false,"sendError":false,"encoding":"binary","x":340,"y":900,"wires":[["a8c56154.d77df8"]]},{"id":"a8c56154.d77df8","type":"function","z":"eba5874f.3a6e38","name":"SACAR ULTIMO DATO","func":"//Buscar fichero mas reciente y devolver su ultimo dato registrado\nvar len = msg.payload.length;\nlet array=[];\n\n//var json1 = JSON.parse(array);\n\nvar ts= msg.payload[len-13].toString(16);\nts += msg.payload[len-14].toString(16);\nts += msg.payload[len-15].toString(16);\nts += msg.payload[len-16].toString(16);\narray.push(parseInt(ts,16));\n\nvar var1 = msg.payload[len-11].toString(16);\nvar1 += msg.payload[len-12].toString(16);\narray.push(parseFloat(parseInt(var1,16))/10);\n\nvar var2 = msg.payload[len-9].toString(16);\nvar2 += msg.payload[len-10].toString(16);\narray.push(parseFloat(parseInt(var2,16))/10);\n\nvar var3 = msg.payload[len-7].toString(16);\nvar3 += msg.payload[len-8].toString(16);\narray.push(parseFloat(parseInt(var3,16))/10);\n\nvar var4 = msg.payload[len-5].toString(16);\nvar4 += msg.payload[len-6].toString(16);\narray.push(parseFloat(parseInt(var4,16))/10);\n\nvar var5 = msg.payload[len-3].toString(16);\nvar5 += msg.payload[len-4].toString(16);\narray.push(parseFloat(parseInt(var5,16))/10);\n\nvar var6 = msg.payload[len-1].toString(16);\nvar6+= msg.payload[len-2].toString(16);\narray.push(parseFloat(parseInt(var6,16))/10);\n\nvar json1 = JSON.stringify(array);\nmsg.payload = json1;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":550,"y":900,"wires":[["ae4cad1e.e22718"]]},{"id":"74e5fe4a.a6262","type":"http in","z":"eba5874f.3a6e38","name":"","url":"/dev1","method":"post","upload":false,"swaggerDoc":"","x":950,"y":2320,"wires":[["f5e5ed4e.97235","57e87b6e.d3c5bc"]]},{"id":"57e87b6e.d3c5bc","type":"http response","z":"eba5874f.3a6e38","name":"","statusCode":"","headers":{},"x":1240,"y":2360,"wires":[]},{"id":"6d034e1a.fd8698","type":"comment","z":"eba5874f.3a6e38","name":"CURL POST","info":"curl -d \"var1=77.7\" -X POST http://127.0.0.1:1880/dev1","x":1150,"y":2260,"wires":[]},{"id":"493e404a.6e9e88","type":"exec","z":"eba5874f.3a6e38","command":"ls","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":400,"y":2340,"wires":[["7a2ba137.f17458"],[],[]]},{"id":"1cc14069.f1b8b","type":"inject","z":"eba5874f.3a6e38","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":210,"y":2340,"wires":[["493e404a.6e9e88"]]},{"id":"7a2ba137.f17458","type":"debug","z":"eba5874f.3a6e38","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":580,"y":2360,"wires":[]},{"id":"bde9b312.199cb8","type":"http in","z":"eba5874f.3a6e38","name":"","url":"/dev1/historic","method":"get","upload":false,"swaggerDoc":"","x":170,"y":980,"wires":[["24c7a1ff.548516"]]},{"id":"343df466.8c45ac","type":"function","z":"eba5874f.3a6e38","name":"MOSTRAR TODO FICHERO RT","func":"var len = msg.payload.length;\nvar num = len/16;\nconst tam = 16;\nlet array=[];\nvar dato = [];\n//var json1 = JSON.stringify(array);\n//var json1 = JSON.parse(array);\n\nfor(i = 0; i < len; i+=16){\n\nvar ts= msg.payload[3+i].toString(16);\nts += msg.payload[2+i].toString(16);\nts += msg.payload[1+i].toString(16);\nts += msg.payload[0+i].toString(16);\narray.push(parseInt(ts,16)*1000);\n\nvar var1 = msg.payload[5+i].toString(16);\nvar1 += msg.payload[4+i].toString(16);\narray.push(parseFloat(parseInt(var1,16))/10);\n\nvar var2 = msg.payload[7+i].toString(16);\nvar2 += msg.payload[6+i].toString(16);\narray.push(parseFloat(parseInt(var2,16))/10);\n\nvar var3 = msg.payload[9+i].toString(16);\nvar3 += msg.payload[8+i].toString(16);\narray.push(parseFloat(parseInt(var3,16))/10);\n\nvar var4 = msg.payload[11+i].toString(16);\nvar4 += msg.payload[10+i].toString(16);\narray.push(parseFloat(parseInt(var4,16))/10);\n\nvar var5 = msg.payload[13+i].toString(16);\nvar5 += msg.payload[12+i].toString(16);\narray.push(parseFloat(parseInt(var5,16))/10);\n\nvar var6 = msg.payload[15+i].toString(16);\nvar6+= msg.payload[14+i].toString(16);\narray.push(parseFloat(parseInt(var6,16))/10);\n\nvar data1={\"timestamp\":array[0],\"var1\":array[1],\"var2\":array[2],\"var3\":array[3],\"var4\":array[4],\"var5\":array[5],\"var6\":array[6]};\ndato = [].concat(dato,data1);\narray = [];\ndata1={};\n\n}\nmsg.payload = dato;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":980,"wires":[["130cc558.3d509b","ae4cad1e.e22718"]]},{"id":"24c7a1ff.548516","type":"file in","z":"eba5874f.3a6e38","name":"","filename":"/home/borja/Desktop/1000C1000E1B/history/5m/1000C1000E1B-20200109-19:00:00.cnd","format":"","chunk":false,"sendError":false,"encoding":"binary","x":510,"y":1040,"wires":[["343df466.8c45ac"]]},{"id":"a64b7b47.72909","type":"function","z":"eba5874f.3a6e38","name":"SACAR ULTIMO DATO","func":"//Buscar fichero mas reciente y devolver su ultimo dato registrado\nvar len = msg.payload.length;\nlet array=[];\n\n//var json1 = JSON.parse(array);\n\nvar ts= msg.payload[len-13].toString(16);\nts += msg.payload[len-14].toString(16);\nts += msg.payload[len-15].toString(16);\nts += msg.payload[len-16].toString(16);\narray.push(parseInt(ts,16));\n\nvar var1 = msg.payload[len-11].toString(16);\nvar1 += msg.payload[len-12].toString(16);\narray.push(parseFloat(parseInt(var1,16))/10);\n\nvar var2 = msg.payload[len-9].toString(16);\nvar2 += msg.payload[len-10].toString(16);\narray.push(parseFloat(parseInt(var2,16))/10);\n\nvar var3 = msg.payload[len-7].toString(16);\nvar3 += msg.payload[len-8].toString(16);\narray.push(parseFloat(parseInt(var3,16))/10);\n\nvar var4 = msg.payload[len-5].toString(16);\nvar4 += msg.payload[len-6].toString(16);\narray.push(parseFloat(parseInt(var4,16))/10);\n\nvar var5 = msg.payload[len-3].toString(16);\nvar5 += msg.payload[len-4].toString(16);\narray.push(parseFloat(parseInt(var5,16))/10);\n\nvar var6 = msg.payload[len-1].toString(16);\nvar6+= msg.payload[len-2].toString(16);\narray.push(parseFloat(parseInt(var6,16))/10);\n\nvar json1 = JSON.stringify(array);\nmsg.payload = json1;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":950,"y":640,"wires":[["4f1ea469.99dcbc"]]},{"id":"eb297042.82ca48","type":"function","z":"eba5874f.3a6e38","name":"MOSTRAR TODO FICHERO RT","func":"var len = msg.payload.length;\nvar num = len/16;\nconst tam = 16;\nlet array=[];\nvar dato = [];\n//var json1 = JSON.stringify(array);\n//var json1 = JSON.parse(array);\n\nfor(i = 0; i < len; i+=16){\n\nvar ts= msg.payload[3+i].toString(16);\nts += msg.payload[2+i].toString(16);\nts += msg.payload[1+i].toString(16);\nts += msg.payload[0+i].toString(16);\narray.push(parseInt(ts,16)*1000);\n\nvar var1 = msg.payload[5+i].toString(16);\nvar1 += msg.payload[4+i].toString(16);\narray.push(parseFloat(parseInt(var1,16))/10);\n\nvar var2 = msg.payload[7+i].toString(16);\nvar2 += msg.payload[6+i].toString(16);\narray.push(parseFloat(parseInt(var2,16))/10);\n\nvar var3 = msg.payload[9+i].toString(16);\nvar3 += msg.payload[8+i].toString(16);\narray.push(parseFloat(parseInt(var3,16))/10);\n\nvar var4 = msg.payload[11+i].toString(16);\nvar4 += msg.payload[10+i].toString(16);\narray.push(parseFloat(parseInt(var4,16))/10);\n\nvar var5 = msg.payload[13+i].toString(16);\nvar5 += msg.payload[12+i].toString(16);\narray.push(parseFloat(parseInt(var5,16))/10);\n\nvar var6 = msg.payload[15+i].toString(16);\nvar6+= msg.payload[14+i].toString(16);\narray.push(parseFloat(parseInt(var6,16))/10);\n\nvar data1={\"timestamp\":array[0],\"var1\":array[1],\"var2\":array[2],\"var3\":array[3],\"var4\":array[4],\"var5\":array[5],\"var6\":array[6]};\ndato = [].concat(dato,data1);\narray = [];\ndata1={};\n\n}\nmsg.payload = dato;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":950,"y":700,"wires":[["4f1ea469.99dcbc"]]},{"id":"75a656ef.ba2a2","type":"split","z":"eba5874f.3a6e38","name":"","splt":"2","spltType":"len","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":590,"y":640,"wires":[["e03808eb.8c8fe"]]},{"id":"e03808eb.8c8fe","type":"join","z":"eba5874f.3a6e38","name":"","mode":"custom","build":"array","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":730,"y":640,"wires":[["a64b7b47.72909","eb297042.82ca48"]]},{"id":"ef3d4635.60177","type":"debug","z":"eba5874f.3a6e38","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":760,"y":1340,"wires":[]},{"id":"adbf1fa5.98c06","type":"debug","z":"eba5874f.3a6e38","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1190,"y":1280,"wires":[]},{"id":"d9877010.3e4aa8","type":"function","z":"eba5874f.3a6e38","name":"","func":"var payload = \"[ [esto es una prueba] ]\";\npayload = payload.substring(2,payload.length-2);\nmsg.payload = payload;\nreturn msg","outputs":1,"noerr":0,"initialize":"","finalize":"","x":540,"y":440,"wires":[["c0126211.72fd58"]]},{"id":"c0126211.72fd58","type":"debug","z":"eba5874f.3a6e38","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":700,"y":440,"wires":[]},{"id":"2bd7794c.aec44e","type":"inject","z":"eba5874f.3a6e38","name":"","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":360,"y":380,"wires":[["d9877010.3e4aa8"]]},{"id":"3290c7f9.71096","type":"worldmap","z":"4f00e6b5.36f52","name":"Mapa","lat":"43.269","lon":"-2.9368","zoom":"14","layer":"OSM","cluster":"","maxage":"","usermenu":"show","layers":"show","panit":"false","hiderightclick":"true","coords":"deg","path":"","x":830,"y":280,"wires":[]},{"id":"db0d11cf.67e218","type":"function","z":"ce6c19fc.98d908","name":"informacion","func":"msg.payload = { \n    \"name\":\"Noisens Dev1\", \n    \"lat\":43.2623, \"lon\":-2.9487,\n    \"Descripción\":\"Sonómetro de la escuela\",\n    \"url\":\"<a href=\\\"https://ehu.eus\\\">www.ehu.eus</a>\",\n    \"clickable\":true};\n\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":450,"y":80,"wires":[[]]},{"id":"1d808308.627465","type":"function","z":"f8f4e452.21dac","name":"estado","func":"if(msg.payload.action===\"connected\"){\n    return msg;\n}\nreturn null;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":310,"y":80,"wires":[["31656968.88bdfe"]]},{"id":"31656968.88bdfe","type":"function","z":"f8f4e452.21dac","name":"Información","func":"msg.payload = { \"name\":\"Noisens Dev2\", \n\"lat\":43.2646, \"lon\":-2.9304,\n\"url\":\"<a href=\\\"https://noismart.com\\\">IBM link</a>\"};\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":490,"y":80,"wires":[[]]},{"id":"9fb534f7.d8c5b","type":"inject","z":"4f00e6b5.36f52","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"/worldmap","payloadType":"str","x":170,"y":160,"wires":[["776aa5f8.b744ac"]]},{"id":"776aa5f8.b744ac","type":"template","z":"4f00e6b5.36f52","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<iframe src={{{payload}}} height=600px; width=600px;></iframe>\n","output":"str","x":400,"y":160,"wires":[["6330fdc1.8ee4f4"]]},{"id":"6330fdc1.8ee4f4","type":"ui_template","z":"4f00e6b5.36f52","group":"25e5cf9b.11ff88","name":"","order":1,"width":13,"height":12,"format":"<div ng-bind-html=\"msg.payload | trusted\"></div>\n\n","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":600,"y":160,"wires":[[]]},{"id":"d7a9aa26.7b509","type":"worldmap in","z":"4f00e6b5.36f52","name":"Mapa","path":"","x":150,"y":280,"wires":[["e47afa5b.3d95f8","fa66eb0f.6e1948"]]},{"id":"2cebc452.67514c","type":"switch","z":"ce6c19fc.98d908","name":"","property":"payload.name","propertyType":"msg","rules":[{"t":"eq","v":"Noisens Dev1","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":350,"y":160,"wires":[["8a54976d.f45b8","2c06bcaa.0a480c"]]},{"id":"14ef7fff.50219","type":"switch","z":"ce6c19fc.98d908","name":"","property":"payload.action","propertyType":"msg","rules":[{"t":"eq","v":"click","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":230,"y":160,"wires":[["2cebc452.67514c"]]},{"id":"1da443af.293b7c","type":"json","z":"3d4d9d1d.b4ee6a","name":"","property":"payload","action":"","pretty":false,"x":310,"y":120,"wires":[["993909cd.d6f708","f0c21d3b.4c04","c303f9a7.c968e8","78617442.e089b4"]]},{"id":"993909cd.d6f708","type":"function","z":"3d4d9d1d.b4ee6a","name":"Media (ultimo min)","func":"var decibelio = parseFloat(msg.payload[0][6]);\nvar potencia = 10**(decibelio/10);\nfor(i=1; i<60; i++){\n    var dec = parseFloat(msg.payload[i][6]);\n    potencia = (10**(dec/10) + potencia);\n}\nmedia = 10*Math.log10(potencia/60);\nmsg.payload = media.toFixed(2);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":450,"y":220,"wires":[["a5716fdf.2ca968"]]},{"id":"b1d6dcd8.220ca","type":"function","z":"3d4d9d1d.b4ee6a","name":"crear array XY","func":"var chart = [{\n    \"series\":[\"Media\"],\n    \"data\":[msg.data],\n    \"labels\":[\"\"]\n}];\nmsg.payload = chart;\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":180,"wires":[["79ee7771.c6e88"]]},{"id":"f0c21d3b.4c04","type":"function","z":"3d4d9d1d.b4ee6a","name":"ultimo valor media","func":"var len = msg.payload.length;\nmsg.payload = msg.payload[len-1][1];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":450,"y":300,"wires":[["b51cb6ff.32f5d"]]},{"id":"a5716fdf.2ca968","type":"ui_gauge","z":"3d4d9d1d.b4ee6a","name":"","group":"feaef2f1.c0818","order":5,"width":6,"height":3,"gtype":"gage","title":"Media último minuto","label":"dB","format":"{{msg.payload}}","min":"40","max":"100","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":680,"y":220,"wires":[]},{"id":"79ee7771.c6e88","type":"ui_chart","z":"3d4d9d1d.b4ee6a","name":"","group":"feaef2f1.c0818","order":7,"width":17,"height":8,"label":"Gráfica último minuto","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"x":820,"y":120,"wires":[[]]},{"id":"c303f9a7.c968e8","type":"split","z":"3d4d9d1d.b4ee6a","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":450,"y":120,"wires":[["4cd017a8.68bac8"]]},{"id":"24f7afa1.3b8b9","type":"join","z":"3d4d9d1d.b4ee6a","name":"","mode":"custom","build":"array","property":"data","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":610,"y":120,"wires":[["b1d6dcd8.220ca"]]},{"id":"4cd017a8.68bac8","type":"function","z":"3d4d9d1d.b4ee6a","name":"obtener XY","func":"var time = parseInt(msg.payload[0]*1000)-140000; //Ajuste de timestamp\nvar valor = parseFloat(msg.payload[1]);\nvar data = {\"x\":time,\"y\":valor};\nmsg.data = data;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":510,"y":180,"wires":[["24f7afa1.3b8b9"]]},{"id":"b51cb6ff.32f5d","type":"ui_gauge","z":"3d4d9d1d.b4ee6a","name":"","group":"feaef2f1.c0818","order":6,"width":6,"height":3,"gtype":"gage","title":"Media último segundo","label":"dB","format":"{{msg.payload}}","min":"40","max":"100","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":680,"y":300,"wires":[]},{"id":"8a54976d.f45b8","type":"change","z":"ce6c19fc.98d908","name":"Mostrar dispositivo","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"group\":{\"hide\":[\"Home_Noisens_2\"],\"show\":[\"Home_Noisens\"]}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":270,"y":200,"wires":[[]]},{"id":"1c85c089.6179a7","type":"ui_ui_control","z":"4f00e6b5.36f52","name":"","events":"connect","x":840,"y":320,"wires":[[]]},{"id":"60eec5df.2b65b4","type":"function","z":"ce6c19fc.98d908","name":"estado","func":"if(msg.payload.action===\"connected\"){\n    return msg;\n}\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":250,"y":80,"wires":[["db0d11cf.67e218"]]},{"id":"78617442.e089b4","type":"function","z":"3d4d9d1d.b4ee6a","name":"Maxima ult min","func":"var max = parseFloat(msg.payload[0][1]);\nfor(i=1;i<60;i++)\n    if(max < parseFloat(msg.payload[i][1]))\n        max = parseFloat(msg.payload[i][1]);\nmsg.payload = max;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":440,"y":260,"wires":[["48604c9d.fbc83c"]]},{"id":"48604c9d.fbc83c","type":"ui_gauge","z":"3d4d9d1d.b4ee6a","name":"","group":"feaef2f1.c0818","order":4,"width":6,"height":3,"gtype":"gage","title":"Máximo último min","label":"dB","format":"{{msg.payload}}","min":"40","max":"100","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":670,"y":260,"wires":[]},{"id":"645d4646.327c","type":"switch","z":"f8f4e452.21dac","name":"","property":"payload.name","propertyType":"msg","rules":[{"t":"eq","v":"Noisens Dev2","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":310,"y":140,"wires":[["4112dd6b.3196b4","aad11452.5a0fd"]]},{"id":"c3c6e994.9b4418","type":"switch","z":"f8f4e452.21dac","name":"","property":"payload.action","propertyType":"msg","rules":[{"t":"eq","v":"click","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":190,"y":140,"wires":[["645d4646.327c"]]},{"id":"4112dd6b.3196b4","type":"change","z":"f8f4e452.21dac","name":"Mostrar Noinsens","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"group\":{\"hide\":[\"Home_Noisens\"],\"show\":[\"Home_Noisens_2\"]}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":230,"y":180,"wires":[[]]},{"id":"2c06bcaa.0a480c","type":"ui_text","z":"ce6c19fc.98d908","group":"feaef2f1.c0818","order":2,"width":5,"height":1,"name":"","label":"","format":"{{msg.payload.name}}","layout":"row-center","x":530,"y":160,"wires":[]},{"id":"aad11452.5a0fd","type":"ui_text","z":"f8f4e452.21dac","group":"68a0e91c.3567a8","order":2,"width":5,"height":1,"name":"","label":"Nombre dispositivo","format":"{{msg.payload.name}}","layout":"row-center","x":510,"y":140,"wires":[]},{"id":"d03c4f49.a5ffa8","type":"json","z":"c6d78d7b.d36f88","name":"","property":"payload","action":"","pretty":false,"x":310,"y":120,"wires":[["c3c4a336.d1574","747b0716.57a0d","4437f421.bd7c1c","b6ca7ae8.18f0c"]]},{"id":"c3c4a336.d1574","type":"function","z":"c6d78d7b.d36f88","name":"Media (ultimo min)","func":"var decibelio = parseFloat(msg.payload[0][6]);\nvar potencia = 10**(decibelio/10);\nfor(i=1; i<60; i++){\n    var dec = parseFloat(msg.payload[i][6]);\n    potencia = (10**(dec/10) + potencia);\n}\nmedia = 10*Math.log10(potencia/60);\nmsg.payload = media.toFixed(2);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":470,"y":220,"wires":[["92a99234.b7cad8"]]},{"id":"9ac4d172.5a9c2","type":"function","z":"c6d78d7b.d36f88","name":"crear array XY","func":"var chart = [{\n    \"series\":[\"Media\"],\n    \"data\":[msg.data],\n    \"labels\":[\"\"]\n}];\nmsg.payload = chart;\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":740,"y":180,"wires":[["b179175a.a437b8"]]},{"id":"747b0716.57a0d","type":"function","z":"c6d78d7b.d36f88","name":"ultimo valor media","func":"var len = msg.payload.length;\nmsg.payload = msg.payload[len-1][6];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":470,"y":300,"wires":[["170bfc87.7c9d6b"]]},{"id":"92a99234.b7cad8","type":"ui_gauge","z":"c6d78d7b.d36f88","name":"","group":"68a0e91c.3567a8","order":6,"width":6,"height":3,"gtype":"gage","title":"Media último minuto","label":"dB","format":"{{msg.payload}}","min":"40","max":"100","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":700,"y":220,"wires":[]},{"id":"b179175a.a437b8","type":"ui_chart","z":"c6d78d7b.d36f88","name":"","group":"68a0e91c.3567a8","order":7,"width":17,"height":8,"label":"Gráfica último minuto","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"x":840,"y":120,"wires":[[]]},{"id":"4437f421.bd7c1c","type":"split","z":"c6d78d7b.d36f88","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":470,"y":120,"wires":[["4b4cb384.fec3a4"]]},{"id":"5ff39656.5be608","type":"join","z":"c6d78d7b.d36f88","name":"","mode":"custom","build":"array","property":"data","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":630,"y":120,"wires":[["9ac4d172.5a9c2"]]},{"id":"4b4cb384.fec3a4","type":"function","z":"c6d78d7b.d36f88","name":"obtener XY","func":"var time = parseInt(msg.payload[0]*1000)-140000; //Ajuste de timestamp\nvar valor = parseFloat(msg.payload[1]);\nvar data = {\"x\":time,\"y\":valor};\nmsg.data = data;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":530,"y":180,"wires":[["5ff39656.5be608"]]},{"id":"170bfc87.7c9d6b","type":"ui_gauge","z":"c6d78d7b.d36f88","name":"","group":"68a0e91c.3567a8","order":4,"width":6,"height":3,"gtype":"gage","title":"Media último segundo","label":"dB","format":"{{msg.payload}}","min":"40","max":"100","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":700,"y":300,"wires":[]},{"id":"b6ca7ae8.18f0c","type":"function","z":"c6d78d7b.d36f88","name":"Maxima ult min","func":"var max = parseFloat(msg.payload[0][4]);\nfor(i=1;i<60;i++)\n    if(max < parseFloat(msg.payload[i][4]))\n        max = parseFloat(msg.payload[i][4]);\nmsg.payload = max;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":460,"y":260,"wires":[["6526d53d.c0963c"]]},{"id":"6526d53d.c0963c","type":"ui_gauge","z":"c6d78d7b.d36f88","name":"","group":"68a0e91c.3567a8","order":5,"width":6,"height":3,"gtype":"gage","title":"Máximo último min","label":"dB","format":"{{msg.payload}}","min":"40","max":"100","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":690,"y":260,"wires":[]},{"id":"52704a93.465fc4","type":"comment","z":"d82e681b.db9d","name":"HTTP","info":"","x":90,"y":620,"wires":[]},{"id":"47ad5988.f8fa7","type":"fred out","z":"d82e681b.db9d","name":"","server":"","client":"e583c334.a63eb8","x":620,"y":300,"wires":[]},{"id":"ca3bed5b.037da8","type":"function","z":"d82e681b.db9d","name":"Filtrar (sin EMPTY)","func":"if(msg.payload.length != 4){\n    return msg\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":310,"y":200,"wires":[["6305536e.27c7c4","47ad5988.f8fa7","e8b49d47.e1c6a"]]},{"id":"a4018063.6969d","type":"fred in","z":"d82e681b.db9d","name":"","server":"","client":"45e654b3.6f69fc","x":110,"y":560,"wires":[["89f56088.e74838"]]},{"id":"58806cd2.606d34","type":"file in","z":"d82e681b.db9d","name":"","filename":"/home/borja/Desktop/DataWS.txt","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":620,"y":600,"wires":[["4381f7f9.1c5208"]]},{"id":"4df7904.64d5bf","type":"inject","z":"d82e681b.db9d","name":"","props":[],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":230,"y":620,"wires":[["58806cd2.606d34"]]},{"id":"4381f7f9.1c5208","type":"fred out","z":"d82e681b.db9d","name":"","server":"","client":"ca6d7a12.4824c","x":990,"y":600,"wires":[]},{"id":"89f56088.e74838","type":"switch","z":"d82e681b.db9d","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":310,"y":560,"wires":[["58806cd2.606d34"]]},{"id":"45f58d27.5fcd4c","type":"http request","z":"d82e681b.db9d","name":"Enviar a Thinger","method":"POST","ret":"txt","paytoqs":"ignore","url":"https://api.thinger.io/v1/users/borja/buckets/MyBucketID/data","tls":"","persist":false,"proxy":"","authType":"bearer","x":760,"y":200,"wires":[[]]},{"id":"6305536e.27c7c4","type":"json","z":"d82e681b.db9d","name":"","property":"payload","action":"obj","pretty":false,"x":570,"y":200,"wires":[["45f58d27.5fcd4c"]]},{"id":"e47afa5b.3d95f8","type":"subflow:ce6c19fc.98d908","z":"4f00e6b5.36f52","name":"Configuracion_Device1","env":[],"x":470,"y":280,"wires":[["3290c7f9.71096"],["1c85c089.6179a7"]],"outputLabels":["Mapa","Control"],"icon":"font-awesome/fa-cog"},{"id":"e8b49d47.e1c6a","type":"change","z":"d82e681b.db9d","name":"Añadir ID","rules":[{"t":"set","p":"id","pt":"msg","to":"920a979d.f8b3b","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":580,"y":100,"wires":[["813abfcd.2dd1a8"]]},{"id":"8aa3eb63.93e3f","type":"switch","z":"4f00e6b5.36f52","name":"","property":"id","propertyType":"msg","rules":[{"t":"eq","v":"920a979d.f8b3b","vt":"str"},{"t":"eq","v":"a8c170bf.ba0628","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":290,"y":460,"wires":[["1f10fa3b.e0476e"],["ed2b179d.45a2d8"]]},{"id":"fa66eb0f.6e1948","type":"subflow:f8f4e452.21dac","z":"4f00e6b5.36f52","name":"Configuracion_Device2","env":[],"x":470,"y":320,"wires":[["3290c7f9.71096"],["1c85c089.6179a7"]],"icon":"font-awesome/fa-cog"},{"id":"ed2b179d.45a2d8","type":"subflow:c6d78d7b.d36f88","z":"4f00e6b5.36f52","name":"Dashboard_Dev2","env":[],"x":570,"y":500,"wires":[],"icon":"node-red-contrib-maps/map.png"},{"id":"4d9a4b9.d3d68b4","type":"comment","z":"4f00e6b5.36f52","name":"Representar Dashboard:","info":"","x":190,"y":400,"wires":[]},{"id":"8e9ddc41.303198","type":"comment","z":"4f00e6b5.36f52","name":"Configurar dispositivos en el mapa:","info":"","x":220,"y":240,"wires":[]},{"id":"813abfcd.2dd1a8","type":"subflow:4f00e6b5.36f52","z":"d82e681b.db9d","name":"Interfaz propia","env":[],"x":760,"y":100,"wires":[]},{"id":"1f10fa3b.e0476e","type":"subflow:3d4d9d1d.b4ee6a","z":"4f00e6b5.36f52","name":"Dashboard_Dev1","env":[],"x":570,"y":440,"wires":[],"icon":"node-red-contrib-maps/map.png"},{"id":"2b4f9d2e.1396e2","type":"function","z":"d82e681b.db9d","name":"Filtrar (sin EMPTY)","func":"if(msg.payload.length != 4){\n    return msg\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":350,"y":420,"wires":[["4118b841.7881c"]]},{"id":"4118b841.7881c","type":"change","z":"d82e681b.db9d","name":"Añadir ID","rules":[{"t":"set","p":"id","pt":"msg","to":"a8c170bf.ba0628","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":420,"wires":[[]]},{"id":"4be854ff.564ca4","type":"myWebsocket","z":"d82e681b.db9d","name":"Noisens Disp 1","url":"ws://server.noismart.com/ws/?uuid=0281F5999510","subprotocol":"protocol-noisens","x":120,"y":200,"wires":[["ca3bed5b.037da8"]]},{"id":"719de4f4.799204","type":"myWebsocket","z":"d82e681b.db9d","name":"Noisens Dev2","url":"ws://server.noismart.com/ws/?uuid=0281F5999510","subprotocol":"protocol-noisens","x":130,"y":420,"wires":[["2b4f9d2e.1396e2"]]},{"id":"56705b05.5f3454","type":"comment","z":"4f00e6b5.36f52","name":"Creación del mapa:","info":"","x":170,"y":120,"wires":[]},{"id":"e446fadb.1536e","type":"function","z":"eba5874f.3a6e38","name":"Media (ultimo min)","func":"var d1 = 65.2;\nvar d2 = 68.3;\nvar d3 = 67.1;\nvar d4 = 69.8;\nvar d5 = 72;\nvar p1 = 10**(d1/10);\nvar p2 = 10**(d2/10);\nvar p3 = 10**(d3/10);\nvar p4 = 10**(d4/10);\nvar p5 = 10**(d5/10);\nvar potencia = p1+p2+p3+p4+p5;\nmedia = 10*Math.log10(potencia/5);\nmsg.payload = media.toFixed(2);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":190,"y":460,"wires":[["f282ac5.ffe04d"]]},{"id":"88727ade.7cbdf8","type":"inject","z":"eba5874f.3a6e38","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":90,"y":420,"wires":[["e446fadb.1536e"]]},{"id":"f282ac5.ffe04d","type":"debug","z":"eba5874f.3a6e38","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":320,"y":520,"wires":[]}]
```
## Autor: ✒️
**Francisco de Borja Esteban** - festeban002@ikasle.ehu.eus
